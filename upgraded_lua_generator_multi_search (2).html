function safeSearch(value, type, range)
    gg.setRanges(range)
    gg.clearResults()
    ${searchDelay > 0 ? `gg.sleep(${searchDelay})` : ''}
    
    local searchResult = gg.searchNumber(value, type)
    if searchResult == nil then
        gg.alert("❌ Search failed for value: " .. tostring(value))
        return false
    end
    
    local results = gg.getResults(${maxResults})
    if #results == 0 then
        gg.alert("⚠️ No results found for value: " .. tostring(value))
        return false
    end
    
    gg.alert("✅ Found " .. #results .. " results for value: " .. tostring(value))
    return true
end

function safeRefine(value, type)
    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPMGARAGESTUDIOS - Lua Generator Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.31.1/ace.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            position: relative;
            height: 100%;
            background: black;
            font-family: "Orbitron", sans-serif;
            overflow-x: hidden;
            color: #0ff;
        }

        canvas#matrix {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            opacity: 0.15;
        }

        .container {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 2rem 1rem 1rem;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #0ff, #08f);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 900;
            color: black;
            box-shadow: 0 0 20px #0ff, 0 0 40px #0ff;
            animation: pulse 2s ease-in-out infinite alternate;
            border: 2px solid #0ff;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.05); }
        }

        h1.neon {
            font-size: clamp(2rem, 5vw, 3.5rem);
            color: #0ff;
            text-shadow: 0 0 5px #0ff, 0 0 15px #0ff, 0 0 30px #08f;
            animation: flicker 1.5s infinite alternate;
            font-weight: 700;
            margin-bottom: 10px;
        }

        @keyframes flicker {
            0% { opacity: 1; }
            50% { opacity: 0.85; }
            100% { opacity: 1; }
        }

        .subtitle {
            font-size: 1.2rem;
            color: #0ff;
            font-weight: 300;
            opacity: 0.8;
            text-shadow: 0 0 10px #0ff;
        }

        .main-panel {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid #0ff;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 0 15px #0ff, 0 0 30px rgba(0, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .main-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #0ff, transparent);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #0ff;
            font-size: 1rem;
            text-shadow: 0 0 5px #0ff;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #0ff;
            border-radius: 8px;
            color: #0ff;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.1);
        }

        .input-field:focus {
            outline: none;
            border-color: #08f;
            box-shadow: 0 0 15px #0ff, inset 0 0 15px rgba(0, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.9);
        }

        .input-field::placeholder {
            color: rgba(0, 255, 255, 0.5);
        }

        .functions-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .function-card {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #0ff;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .function-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px #0ff, 0 8px 25px rgba(0, 255, 255, 0.4);
            border-color: #08f;
        }

        .function-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }

        .function-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #0ff;
            text-shadow: 0 0 10px #0ff;
        }

        .remove-function {
            background: rgba(255, 0, 100, 0.8);
            border: 2px solid #f0f;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            color: #f0f;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 0 10px #f0f;
        }

        .remove-function:hover {
            background: #f0f;
            color: black;
            transform: scale(1.1);
            box-shadow: 0 0 20px #f0f;
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-item {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(0, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .search-item:hover {
            border-color: #0ff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .add-search-btn {
            background: linear-gradient(45deg, #0ff, #08f);
            border: 2px solid #0ff;
            border-radius: 8px;
            padding: 10px 20px;
            color: black;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
            font-family: 'Orbitron', sans-serif;
            box-shadow: 0 0 10px #0ff;
        }

        .add-search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px #0ff;
            background: linear-gradient(45deg, #08f, #0ff);
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .neon-button {
            flex: 1;
            min-width: 200px;
            height: 60px;
            padding: 15px 25px;
            color: #0ff;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            text-decoration: none;
            border: 2px solid #0ff;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 10px #0ff;
        }

        .neon-button::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            border: 2px solid #0ff;
            box-shadow: 0 0 15px #0ff;
            opacity: 0;
            animation: border-flicker 2s infinite;
        }

        .neon-button:hover::before {
            opacity: 1;
        }

        .neon-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #0ff, 0 0 30px #0ff;
        }

        @keyframes border-flicker {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.2; }
        }

        .neon-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
        }

        .neon-button:disabled:hover {
            transform: none;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
        }

        .btn-secondary {
            border-color: #f0f;
            color: #f0f;
            box-shadow: 0 0 10px #f0f;
        }

        .btn-secondary::before {
            border-color: #f0f;
            box-shadow: 0 0 15px #f0f;
        }

        .btn-secondary:hover {
            box-shadow: 0 0 20px #f0f, 0 0 30px #f0f;
        }

        .btn-danger {
            border-color: #ff4757;
            color: #ff4757;
            box-shadow: 0 0 10px #ff4757;
        }

        .btn-danger::before {
            border-color: #ff4757;
            box-shadow: 0 0 15px #ff4757;
        }

        .btn-danger:hover {
            box-shadow: 0 0 20px #ff4757, 0 0 30px #ff4757;
        }

        .loader {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-top: 2px solid #0ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .editor-container {
            position: relative;
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #0ff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        #editor {
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
        }

        .advanced-options {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            border: 2px solid rgba(0, 255, 255, 0.5);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .advanced-toggle {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #0ff;
            margin-bottom: 15px;
            text-shadow: 0 0 5px #0ff;
            transition: all 0.3s ease;
        }

        .advanced-toggle:hover {
            text-shadow: 0 0 10px #0ff;
            transform: translateX(5px);
        }

        .advanced-content {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .advanced-content.open {
            display: grid;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            appearance: none;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #0ff;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

        .checkbox:checked {
            background: #0ff;
            border-color: #0ff;
            box-shadow: 0 0 10px #0ff;
        }

        .checkbox:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: black;
            font-weight: bold;
            font-size: 14px;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            border-top: 2px solid rgba(0, 255, 255, 0.3);
            color: #0ff;
            position: relative;
            z-index: 2;
        }

        .footer a {
            color: #f0f;
            text-decoration: none;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px #f0f;
        }

        .footer a:hover {
            color: #0ff;
            text-shadow: 0 0 10px #0ff;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #0ff;
            border-radius: 4px;
            box-shadow: 0 0 5px #0ff;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #08f;
            box-shadow: 0 0 10px #0ff;
        }

        /* SweetAlert2 Custom Theme */
        .swal2-popup {
            background: rgba(0, 0, 0, 0.95) !important;
            color: #0ff !important;
            border: 2px solid #0ff !important;
            border-radius: 10px !important;
            box-shadow: 0 0 20px #0ff !important;
        }

        .swal2-title {
            color: #0ff !important;
            text-shadow: 0 0 10px #0ff !important;
        }

        .swal2-content {
            color: #0ff !important;
        }

        .swal2-confirm {
            background: #0ff !important;
            color: black !important;
            border: 2px solid #0ff !important;
            border-radius: 8px !important;
            font-family: 'Orbitron', sans-serif !important;
            font-weight: 600 !important;
        }

        .swal2-confirm:hover {
            background: #08f !important;
            box-shadow: 0 0 15px #0ff !important;
        }

        .swal2-cancel {
            background: rgba(255, 0, 100, 0.8) !important;
            color: #f0f !important;
            border: 2px solid #f0f !important;
            border-radius: 8px !important;
            font-family: 'Orbitron', sans-serif !important;
            font-weight: 600 !important;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .search-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .neon-button {
                min-width: auto;
            }
            
            .advanced-content {
                grid-template-columns: 1fr;
            }

            .logo-container {
                flex-direction: column;
                gap: 10px;
            }

            h1.neon {
                font-size: 2rem;
            }
        }

        /* Matrix animation styles */
        .matrix-text {
            color: #0ff;
            text-shadow: 0 0 5px #0ff;
            animation: matrix-glow 2s ease-in-out infinite alternate;
        }

        @keyframes matrix-glow {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <canvas id="matrix"></canvas>
    
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">CPM</div>
            </div>
            <h1 class="neon">CPMGARAGESTUDIOS</h1>
            <p class="subtitle">Advanced Lua Script Generator Pro</p>
        </div>

        <div class="main-panel">
            <div class="input-group">
                <label class="input-label" for="functionsInput">
                    🎯 Function Names (comma-separated)
                </label>
                <input 
                    type="text" 
                    id="functionsInput" 
                    class="input-field"
                    placeholder="e.g: Money Hack, Speed Boost, Infinite Fuel, God Mode"
                    autocomplete="off"
                />
            </div>

            <div class="functions-grid" id="functionsContainer"></div>

            <div class="advanced-options">
                <div class="advanced-toggle" onclick="toggleAdvanced()">
                    ⚙️ Advanced Configuration Options
                    <span id="advancedArrow">▼</span>
                </div>
                <div class="advanced-content" id="advancedContent">
                    <div class="input-group">
                        <label class="input-label">🔍 Search Method</label>
                        <select class="input-field" id="searchMethod">
                            <option value="exact">Exact Value</option>
                            <option value="range">Value Range</option>
                            <option value="fuzzy">Fuzzy Search</option>
                            <option value="encrypted">Encrypted Value</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">⏱️ Search Delay (ms)</label>
                        <input type="number" class="input-field" id="searchDelay" value="500" min="0" max="5000">
                    </div>
                    <div class="input-group">
                        <label class="input-label">🔢 Max Results</label>
                        <input type="number" class="input-field" id="maxResults" value="999" min="1" max="99999">
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox" id="autoSave" checked>
                        <label for="autoSave">💾 Auto-save before edit</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox" id="confirmEdit">
                        <label for="confirmEdit">⚠️ Confirm before edit</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" class="checkbox" id="freezeValues">
                        <label for="freezeValues">🧊 Freeze values after edit</label>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="neon-button" id="generateBtn" disabled>
                    ⚡ Generate Script
                </button>
                <button class="neon-button btn-secondary" id="downloadBtn" disabled>
                    📥 Download Script
                </button>
                <button class="neon-button btn-secondary" id="copyBtn" disabled>
                    📋 Copy to Clipboard
                </button>
                <button class="neon-button btn-danger" id="clearBtn">
                    🗑️ Clear All
                </button>
            </div>

            <div class="editor-container">
                <div id="editor">-- Your generated Lua script will appear here
-- CPMGARAGESTUDIOS Lua Generator Pro
-- Advanced Car Parking Multiplayer Script Generator
-- Visit: https://cpmgarage.github.io/cpmgaragestudios</div>
            </div>
        </div>

        <div class="footer">
            <p>🚀 CPMGARAGESTUDIOS Lua Generator Pro v2.0 | Enhanced for Car Parking Multiplayer</p>
            <p>Made with ❤️ by <a href="https://instagram.com/_cpmgarage" target="_blank">@_CPMGARAGE</a></p>
        </div>
    </div>

    <script>
        // Matrix Rain Effect
        const canvas = document.getElementById("matrix");
        const ctx = canvas.getContext("2d");

        const matrix = "10101011110000101010100111010101001010111100001010101001110101010010101111000010101010011101010100";
        const fontSize = 14;
        let columns;
        let drops;

        function resizeMatrixCanvas() {
            canvas.width = window.innerWidth;
            const fullHeight = Math.max(
                document.body.scrollHeight,
                document.documentElement.scrollHeight,
                document.body.offsetHeight,
                document.documentElement.offsetHeight,
                document.body.clientHeight,
                document.documentElement.clientHeight
            );
            canvas.height = fullHeight;
            columns = Math.floor(canvas.width / fontSize);
            drops = Array(columns).fill(1);
        }

        function draw() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#00faff";
            ctx.font = fontSize + "px Courier New";
            ctx.textBaseline = "top";
            
            for (let i = 0; i < drops.length; i++) {
                const text = matrix.charAt(Math.floor(Math.random() * matrix.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.98) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        window.addEventListener("resize", resizeMatrixCanvas);
        window.addEventListener("load", () => {
            resizeMatrixCanvas();
            setInterval(draw, 120);
            showWelcomePopup();
        });

        // Show informational popup on load
        function showWelcomePopup() {
            Swal.fire({
                title: '🚀 Welcome to CPMGARAGESTUDIOS!',
                html: `
                    <div style="text-align: left; color: #0ff;">
                        <h3 style="color: #0ff; text-shadow: 0 0 10px #0ff; margin-bottom: 15px;">🎮 Advanced Lua Script Generator Pro</h3>
                        
                        <p style="margin-bottom: 10px;"><strong>📋 What this tool does:</strong></p>
                        <ul style="margin-bottom: 15px; padding-left: 20px;">
                            <li>Generates professional Game Guardian scripts for CPM</li>
                            <li>Supports multiple search steps with refinement logic</li>
                            <li>Creates optimized Lua code with error handling</li>
                            <li>Includes advanced timing and messaging controls</li>
                        </ul>
                        
                        <p style="margin-bottom: 10px;"><strong>🔍 Need values for your scripts?</strong></p>
                        <p style="margin-bottom: 15px; color: #f0f;">Visit our <strong>GG Learning Studio</strong> page for comprehensive value databases, tutorials, and search techniques!</p>
                        
                        <p style="color: #f0f; text-shadow: 0 0 5px #f0f;"><strong>🎯 Ready to create professional CPM scripts?</strong></p>
                    </div>
                `,
                icon: null,
                confirmButtonText: '🚀 Start Creating!',
                showCancelButton: true,
                cancelButtonText: '📚 Visit GG Learning Studio',
                allowOutsideClick: false,
                customClass: {
                    popup: 'swal2-popup',
                    title: 'swal2-title',
                    content: 'swal2-content',
                    confirmButton: 'swal2-confirm',
                    cancelButton: 'swal2-cancel'
                }
            }).then((result) => {
                if (result.dismiss === Swal.DismissReason.cancel) {
                    window.open('https://cpmgarage.github.io/cpmgaragestudios', '_blank');
                } else {
                    showTutorialOption();
                }
            });
        }

        // Show tutorial option popup
        function showTutorialOption() {
            Swal.fire({
                title: '📚 Want to Learn Game Guardian Scripting?',
                html: `
                    <div style="text-align: left; color: #0ff;">
                        <h3 style="color: #0ff; text-shadow: 0 0 10px #0ff; margin-bottom: 15px;">🎓 GG Lua Tutorial</h3>
                        
                        <p style="margin-bottom: 15px;">Our interactive tutorial will teach you:</p>
                        <ul style="margin-bottom: 15px; padding-left: 20px;">
                            <li><strong>Search Logic:</strong> How search → refine → refine works</li>
                            <li><strong>Timing Control:</strong> Using sleeps, toasts, and alerts effectively</li>
                            <li><strong>Memory Ranges:</strong> Understanding different GG regions</li>
                            <li><strong>Data Types:</strong> When to use FLOAT, DWORD, etc.</li>
                            <li><strong>Best Practices:</strong> Creating stable, reliable scripts</li>
                        </ul>
                        
                        <p style="color: #f0f; text-shadow: 0 0 5px #f0f;"><strong>💡 Take the tutorial or jump right in?</strong></p>
                    </div>
                `,
                icon: null,
                confirmButtonText: '📚 Enter Tutorial',
                showCancelButton: true,
                cancelButtonText: '⚡ Skip Tutorial',
                allowOutsideClick: false,
                customClass: {
                    popup: 'swal2-popup',
                    title: 'swal2-title',
                    content: 'swal2-content',
                    confirmButton: 'swal2-confirm',
                    cancelButton: 'swal2-cancel'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    showTutorial();
                }
            });
        }

        // Show tutorial steps
        function showTutorial() {
            Swal.fire({
                title: '🎓 GG Lua Tutorial - Step 1/5',
                html: `
                    <div style="text-align: left; color: #0ff;">
                        <h3 style="color: #0ff; text-shadow: 0 0 10px #0ff; margin-bottom: 15px;">🔍 Understanding Search Logic</h3>
                        
                        <p style="margin-bottom: 10px;"><strong>Game Guardian Search Flow:</strong></p>
                        <ol style="margin-bottom: 15px; padding-left: 20px;">
                            <li><strong>Initial Search:</strong> Search for a value (e.g., your current money)</li>
                            <li><strong>Refine Search:</strong> Change the value in-game, then search again</li>
                            <li><strong>More Refinement:</strong> Keep refining until few results remain</li>
                            <li><strong>Edit Values:</strong> Once you have 1-50 results, edit them</li>
                        </ol>
                        
                        <p style="margin-bottom: 10px;"><strong>Example - Money Hack:</strong></p>
                        <ul style="margin-bottom: 15px; padding-left: 20px;">
                            <li>Search: 1000 (your current money)</li>
                            <li>Spend money → Refine: 500 (new amount)</li>
                            <li>Spend more → Refine: 200 (even newer amount)</li>
                            <li>Edit to: 999999 (desired amount)</li>
                        </ul>
                        
                        <p style="color: #f0f;"><strong>💡 This tool automates this exact workflow!</strong></p>
                    </div>
                `,
                icon: null,
                confirmButtonText: 'Next Step →',
                allowOutsideClick: false
            }).then(() => {
                Swal.fire({
                    title: '🎓 GG Lua Tutorial - Step 2/5',
                    html: `
                        <div style="text-align: left; color: #0ff;">
                            <h3 style="color: #0ff; text-shadow: 0 0 10px #0ff; margin-bottom: 15px;">⏱️ Timing Control</h3>
                            
                            <p style="margin-bottom: 10px;"><strong>Why Timing Matters:</strong></p>
                            <ul style="margin-bottom: 15px; padding-left: 20px;">
                                <li><strong>Sleeps:</strong> Give user time to change values in-game</li>
                                <li><strong>Toasts:</strong> Quick notifications that don't pause script</li>
                                <li><strong>Alerts:</strong> Stop script and wait for user confirmation</li>
                            </ul>
                            
                            <p style="margin-bottom: 10px;"><strong>Best Practice Example:</strong></p>
                            <ul style="margin-bottom: 15px; padding-left: 20px;">
                                <li>Alert: "Set your money to exactly 1000"</li>
                                <li>Sleep: 5000ms (5 seconds for user to act)</li>
                                <li>Search: 1000</li>
                                <li>Toast: "Found money addresses!"</li>
                                <li>Alert: "Now spend some money"</li>
                            </ul>
                            
                            <p style="color: #f0f;"><strong>💡 Perfect timing = reliable scripts!</strong></p>
                        </div>
                    `,
                    icon: null,
                    confirmButtonText: 'Next Step →',
                    allowOutsideClick: false
                }).then(() => {
                    Swal.fire({
                        title: '🎓 GG Lua Tutorial - Step 3/5',
                        html: `
                            <div style="text-align: left; color: #0ff;">
                                <h3 style="color: #0ff; text-shadow: 0 0 10px #0ff; margin-bottom: 15px;">🎯 Memory Ranges & Data Types</h3>
                                
                                <p style="margin-bottom: 10px;"><strong>Common Memory Ranges:</strong></p>
                                <ul style="margin-bottom: 15px; padding-left: 20px;">
                                    <li><strong>ANONYMOUS:</strong> Most game values (money, health, etc.)</li>
                                    <li><strong>JAVA_HEAP:</strong> Android app data</li>
                                    <li><strong>C_ALLOC:</strong> Native code allocations</li>
                                </ul>
                                
                                <p style="margin-bottom: 10px;"><strong>Data Types Guide:</strong></p>
                                <ul style="margin-bottom: 15px; padding-left: 20px;">
                                    <li><strong>DWORD:</strong> Whole numbers (money, levels, items)</li>
                                    <li><strong>FLOAT:</strong> Decimal numbers (speed, coordinates)</li>
                                    <li><strong>DOUBLE:</strong> High precision decimals</li>
                                    <li><strong>AUTO:</strong> Let GG guess (less reliable)</li>
                                </ul>
                                
                                <p style="color: #f0f;"><strong>💡 Start with DWORD for integers, FLOAT for decimals!</strong></p>
                            </div>
                        `,
                        icon: null,
                        confirmButtonText: 'Next Step →',
                        allowOutsideClick: false
                    }).then(() => {
                        Swal.fire({
                            title: '🎓 GG Lua Tutorial - Step 4/5',
                            html: `
                                <div style="text-align: left; color: #0ff;">
                                    <h3 style="color: #0ff; text-shadow: 0 0 10px #0ff; margin-bottom: 15px;">🛠️ Using This Generator</h3>
                                    
                                    <p style="margin-bottom: 10px;"><strong>Step-by-Step Process:</strong></p>
                                    <ol style="margin-bottom: 15px; padding-left: 20px;">
                                        <li><strong>Function Names:</strong> Enter your hack names (Money, Speed, etc.)</li>
                                        <li><strong>Search Steps:</strong> Add multiple search/refine steps</li>
                                        <li><strong>Timing:</strong> Set sleeps, toasts, alerts for each step</li>
                                        <li><strong>Final Edit:</strong> Set the value you want to change to</li>
                                        <li><strong>Generate:</strong> Create your professional script!</li>
                                    </ol>
                                    
                                    <p style="margin-bottom: 10px;"><strong>Pro Tips:</strong></p>
                                    <ul style="margin-bottom: 15px; padding-left: 20px;">
                                        <li>Use clear, descriptive alerts</li>
                                        <li>Give users 5-10 seconds between steps</li>
                                        <li>Test with small edit values first</li>
                                        <li>Always backup before major edits</li>
                                    </ul>
                                    
                                    <p style="color: #f0f;"><strong>💡 Practice makes perfect scripts!</strong></p>
                                </div>
                            `,
                            icon: null,
                            confirmButtonText: 'Final Step →',
                            allowOutsideClick: false
                        }).then(() => {
                            Swal.fire({
                                title: '🎓 GG Lua Tutorial - Step 5/5',
                                html: `
                                    <div style="text-align: left; color: #0ff;">
                                        <h3 style="color: #0ff; text-shadow: 0 0 10px #0ff; margin-bottom: 15px;">🚀 Ready to Create!</h3>
                                        
                                        <p style="margin-bottom: 10px;"><strong>You Now Know:</strong></p>
                                        <ul style="margin-bottom: 15px; padding-left: 20px;">
                                            <li>✅ Search → Refine → Refine logic</li>
                                            <li>✅ Timing control with sleeps and alerts</li>
                                            <li>✅ Memory ranges and data types</li>
                                            <li>✅ How to use this generator effectively</li>
                                            <li>✅ Best practices for stable scripts</li>
                                        </ul>
                                        
                                        <p style="margin-bottom: 10px;"><strong>Remember:</strong></p>
                                        <ul style="margin-bottom: 15px; padding-left: 20px;">
                                            <li>🔍 Test scripts in safe environments first</li>
                                            <li>💾 Always backup your game saves</li>
                                            <li>📚 Visit GG Learning Studio for more values</li>
                                            <li>⚠️ Use responsibly and respect game developers</li>
                                        </ul>
                                        
                                        <p style="color: #0f0; text-shadow: 0 0 5px #0f0;"><strong>🎯 Happy scripting with CPMGARAGESTUDIOS!</strong></p>
                                    </div>
                                `,
                                icon: null,
                                confirmButtonText: '🚀 Start Creating Scripts!',
                                allowOutsideClick: false
                            });
                        });
                    });
                });
            });
        }

        // Main Script Logic - RESTORED ORIGINAL LOGIC
        let functionCount = 0;
        let searchCount = {};
        const editor = ace.edit("editor");

        // Editor Setup
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/lua");
        editor.setOptions({
            fontSize: "14px",
            showPrintMargin: false,
            highlightActiveLine: true,
            wrap: true,
            enableBasicAutocompletion: true,
            enableLiveAutocompletion: true
        });

        // Game Guardian Types and Ranges
        const GG_TYPES = [
            "gg.TYPE_DWORD", "gg.TYPE_FLOAT", "gg.TYPE_DOUBLE", "gg.TYPE_QWORD",
            "gg.TYPE_WORD", "gg.TYPE_BYTE", "gg.TYPE_AUTO", "gg.TYPE_XOR"
        ];

        const GG_RANGES = [
            "gg.REGION_ANONYMOUS", "gg.REGION_JAVA_HEAP", "gg.REGION_JAVA",
            "gg.REGION_C_ALLOC", "gg.REGION_C_HEAP", "gg.REGION_PPSSPP",
            "gg.REGION_BAD", "gg.REGION_CODE_APP", "gg.REGION_CODE_SYS",
            "gg.REGION_OTHER", "gg.REGION_VIDEO", "gg.REGION_AUDIO",
            "gg.REGION_CODE", "gg.REGION_STACK", "gg.REGION_ASHMEM"
        ];

        // Event Listeners
        document.getElementById('functionsInput').addEventListener('input', handleFunctionsInput);
        document.getElementById('generateBtn').addEventListener('click', generateScript);
        document.getElementById('downloadBtn').addEventListener('click', downloadScript);
        document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
        document.getElementById('clearBtn').addEventListener('click', clearAll);

        function handleFunctionsInput(e) {
            const input = e.target.value;
            const functions = input.split(',')
                .map(f => f.trim())
                .filter(f => f.length > 0)
                .filter((f, i, arr) => arr.indexOf(f) === i);

            createFunctionCards(functions);
            updateGenerateButton();
        }

        function createFunctionCards(functions) {
            const container = document.getElementById('functionsContainer');
            container.innerHTML = '';
            functionCount = 0;
            searchCount = {};

            if (functions.length === 0) {
                editor.setValue('-- Your generated Lua script will appear here\\n-- CPMGARAGESTUDIOS Lua Generator Pro\\n-- Advanced Car Parking Multiplayer Script Generator\\n-- Visit: https://cpmgarage.github.io/cpmgaragestudios', -1);
                return;
            }

            functions.forEach((funcName, index) => {
                const card = createFunctionCard(funcName, index);
                container.appendChild(card);
                searchCount[index] = 1;
            });

            functionCount = functions.length;
        }

        function createFunctionCard(funcName, index) {
            const card = document.createElement('div');
            card.className = 'function-card';
            card.innerHTML = `
                <div class="function-header">
                    <div class="function-title">🎮 ${funcName}</div>
                    <button class="remove-function" onclick="removeFunction(${index})" title="Remove Function">
                        ✕
                    </button>
                </div>
                <div class="search-container" id="searchContainer${index}">
                    <button class="add-search-btn" onclick="addSearch(${index})">
                        ➕ Add Search Step
                    </button>
                    <div class="search-grid" id="searchGrid${index}">
                        ${createSearchItem(index, 0)}
                    </div>
                </div>
            `;
            return card;
        }

        function createSearchItem(functionIndex, searchIndex) {
            return `
                <div class="search-item" id="search${functionIndex}_${searchIndex}">
                    <div class="input-group">
                        <label class="input-label">💬 Pre-Search Toast ${searchIndex + 1}</label>
                        <input type="text" class="input-field" id="preToast${functionIndex}_${searchIndex}" 
                               placeholder="Toast before search (optional)" 
                               title="Toast message shown before this search step">
                    </div>
                    <div class="input-group">
                        <label class="input-label">⚠️ Pre-Search Alert ${searchIndex + 1}</label>
                        <input type="text" class="input-field" id="preAlert${functionIndex}_${searchIndex}" 
                               placeholder="Alert before search (optional)" 
                               title="Alert message shown before this search step">
                    </div>
                    <div class="input-group">
                        <label class="input-label">⏱️ Pre-Search Sleep ${searchIndex + 1} (ms)</label>
                        <input type="number" class="input-field" id="preSleep${functionIndex}_${searchIndex}" 
                               placeholder="Sleep before search (optional)" min="0" max="10000"
                               title="Milliseconds to sleep before this search step">
                    </div>
                    <div class="input-group">
                        <label class="input-label">🔍 Search Value ${searchIndex + 1}</label>
                        <input type="text" class="input-field" id="searchValue${functionIndex}_${searchIndex}" 
                               placeholder="Enter value (supports negative numbers)" 
                               pattern="-?\\d+(\\.\\d+)?" title="Numbers only (negative allowed)">
                    </div>
                    <div class="input-group">
                        <label class="input-label">🎯 Search Type</label>
                        <select class="input-field" id="searchType${functionIndex}_${searchIndex}">
                            ${GG_TYPES.map(type => `<option value="${type}">${type}</option>`).join('')}
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">🎯 Memory Range</label>
                        <select class="input-field" id="range${functionIndex}_${searchIndex}">
                            ${GG_RANGES.map(range => `<option value="${range}">${range}</option>`).join('')}
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">⏱️ Post-Search Sleep ${searchIndex + 1} (ms)</label>
                        <input type="number" class="input-field" id="postSleep${functionIndex}_${searchIndex}" 
                               placeholder="Sleep after search (optional)" min="0" max="10000"
                               title="Milliseconds to sleep after this search step">
                    </div>
                    <div class="input-group">
                        <label class="input-label">💬 Post-Search Toast ${searchIndex + 1}</label>
                        <input type="text" class="input-field" id="postToast${functionIndex}_${searchIndex}" 
                               placeholder="Toast after search (optional)" 
                               title="Toast message shown after this search step">
                    </div>
                    <div class="input-group">
                        <label class="input-label">⚠️ Post-Search Alert ${searchIndex + 1}</label>
                        <input type="text" class="input-field" id="postAlert${functionIndex}_${searchIndex}" 
                               placeholder="Alert after search (optional)" 
                               title="Alert message shown after this search step">
                    </div>
                    ${searchIndex === 0 ? `
                    <div class="input-group">
                        <label class="input-label">💬 Pre-Edit Toast</label>
                        <input type="text" class="input-field" id="preEditToast${functionIndex}" 
                               placeholder="Toast before edit (optional)" 
                               title="Toast message shown before editing values">
                    </div>
                    <div class="input-group">
                        <label class="input-label">⚠️ Pre-Edit Alert</label>
                        <input type="text" class="input-field" id="preEditAlert${functionIndex}" 
                               placeholder="Alert before edit (optional)" 
                               title="Alert message shown before editing values">
                    </div>
                    <div class="input-group">
                        <label class="input-label">⏱️ Pre-Edit Sleep (ms)</label>
                        <input type="number" class="input-field" id="preEditSleep${functionIndex}" 
                               placeholder="Sleep before edit (optional)" min="0" max="10000"
                               title="Milliseconds to sleep before editing values">
                    </div>
                    <div class="input-group">
                        <label class="input-label">✏️ Final Edit Value</label>
                        <input type="text" class="input-field" id="editValue${functionIndex}" 
                               placeholder="Value to edit to after all searches" 
                               pattern="-?\\d+(\\.\\d+)?" title="Numbers only (negative allowed)">
                    </div>
                    <div class="input-group">
                        <label class="input-label">🎯 Final Edit Type</label>
                        <select class="input-field" id="editType${functionIndex}">
                            ${GG_TYPES.map(type => `<option value="${type}">${type}</option>`).join('')}
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">⏱️ Post-Edit Sleep (ms)</label>
                        <input type="number" class="input-field" id="postEditSleep${functionIndex}" 
                               placeholder="Sleep after edit (optional)" min="0" max="10000"
                               title="Milliseconds to sleep after editing values">
                    </div>
                    <div class="input-group">
                        <label class="input-label">💬 Post-Edit Toast</label>
                        <input type="text" class="input-field" id="postEditToast${functionIndex}" 
                               placeholder="Toast after edit (optional)" 
                               title="Toast message shown after editing values">
                    </div>
                    <div class="input-group">
                        <label class="input-label">⚠️ Post-Edit Alert</label>
                        <input type="text" class="input-field" id="postEditAlert${functionIndex}" 
                               placeholder="Alert after edit (optional)" 
                               title="Alert message shown after editing values">
                    </div>
                    ` : ''}
                    ${searchIndex > 0 ? `<button class="remove-function" onclick="removeSearch(${functionIndex}, ${searchIndex})" style="margin-top: 10px; width: 100%; height: 40px;">Remove Search Step</button>` : ''}
                </div>
            `;
        }

        function addSearch(functionIndex) {
            const searchGrid = document.getElementById(`searchGrid${functionIndex}`);
            const newSearchIndex = searchCount[functionIndex];
            searchGrid.innerHTML += createSearchItem(functionIndex, newSearchIndex);
            searchCount[functionIndex]++;
            updateGenerateButton();
        }

        function removeSearch(functionIndex, searchIndex) {
            const searchItem = document.getElementById(`search${functionIndex}_${searchIndex}`);
            searchItem.remove();
            updateGenerateButton();
        }

        function removeFunction(index) {
            const card = document.querySelector(`.function-card:nth-child(${index + 1})`);
            card.remove();
            
            const functionsInput = document.getElementById('functionsInput');
            const functions = functionsInput.value.split(',').map(f => f.trim()).filter(f => f.length > 0);
            functions.splice(index, 1);
            functionsInput.value = functions.join(', ');
            
            createFunctionCards(functions);
            updateGenerateButton();
        }

        function toggleAdvanced() {
            const content = document.getElementById('advancedContent');
            const arrow = document.getElementById('advancedArrow');
            
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                arrow.textContent = '▼';
            } else {
                content.classList.add('open');
                arrow.textContent = '▲';
            }
        }

        function updateGenerateButton() {
            const generateBtn = document.getElementById('generateBtn');
            const hasValidFunctions = functionCount > 0;
            generateBtn.disabled = !hasValidFunctions;
        }

        function validateInputs() {
            for (let i = 0; i < functionCount; i++) {
                // Check if edit value exists (only on first search item)
                const editValue = document.getElementById(`editValue${i}`)?.value.trim();
                if (!editValue) {
                    throw new Error(`Please enter a final edit value for function ${i + 1}`);
                }
                if (!/^-?\d+(\.\d+)?$/.test(editValue)) {
                    throw new Error(`Invalid final edit value format in function ${i + 1}. Use numbers only (negative allowed).`);
                }

                // Check all search values
                for (let j = 0; j < (searchCount[i] || 1); j++) {
                    const searchValue = document.getElementById(`searchValue${i}_${j}`)?.value.trim();
                    
                    if (!searchValue) {
                        throw new Error(`Please fill the search value for function ${i + 1}, search step ${j + 1}`);
                    }
                    
                    if (!/^-?\d+(\.\d+)?$/.test(searchValue)) {
                        throw new Error(`Invalid search value format in function ${i + 1}, search step ${j + 1}. Use numbers only (negative allowed).`);
                    }
                }
            }
        }

        function generateScript() {
            try {
                validateInputs();
                
                const generateBtn = document.getElementById('generateBtn');
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<span class="loader"></span> Generating...';

                setTimeout(() => {
                    const script = buildLuaScript();
                    editor.setValue(script, -1);
                    
                    document.getElementById('downloadBtn').disabled = false;
                    document.getElementById('copyBtn').disabled = false;
                    
                    Swal.fire({
                        icon: 'success',
                        title: '🎉 Script Generated!',
                        text: 'Your advanced Lua script is ready for CPM!',
                        confirmButtonText: 'Awesome!'
                    });
                    
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = '⚡ Generate Script';
                }, 1000);
                
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: '❌ Validation Error',
                    text: error.message
                });
                
                const generateBtn = document.getElementById('generateBtn');
                generateBtn.disabled = false;
                generateBtn.innerHTML = '⚡ Generate Script';
            }
        }

        function buildLuaScript() {
            const functions = document.getElementById('functionsInput').value
                .split(',').map(f => f.trim()).filter(f => f.length > 0);
            
            const autoSave = document.getElementById('autoSave').checked;
            const confirmEdit = document.getElementById('confirmEdit').checked;
            const freezeValues = document.getElementById('freezeValues').checked;
            const searchDelay = document.getElementById('searchDelay').value;
            const maxResults = document.getElementById('maxResults').value;
            const searchMethod = document.getElementById('searchMethod').value;

            let script = `-- CPMGARAGESTUDIOS Lua Generator Pro v2.0
-- Advanced Car Parking Multiplayer Script with Multi-Search Support
-- Generated: ${new Date().toLocaleString()}
-- Total Functions: ${functions.length}
-- Visit: https://cpmgaragestudios.com
-- Follow: @_CPMGARAGE

`;

            script += `-- Utility Functions
function showBanner()
    gg.alert([[
🚀 CPMGARAGESTUDIOS Lua Generator Pro v2.0
🎮 Car Parking Multiplayer Enhanced Script
🔍 Multi-Search Support Enabled

Features:
${functions.map((f, i) => `  ${i + 1}. ${f}`).join('\\n')}

🔗 Visit: https://cpmgarage.github.io/cpmgaragestudios
📱 Follow: @_CPMGARAGE
📚 Get values at: GG Learning Studio
⚠️ Use responsibly and at your own risk!
    ]], "CPMGARAGESTUDIOS - Ready!", "Continue")
end

function safeSearch(value, type, range)
    gg.setRanges(range)
    ${searchDelay > 0 ? `gg.sleep(${searchDelay})` : ''}
    
    local searchResult = gg.searchNumber(value, type)
    if searchResult == nil then
        gg.alert("❌ Search failed for value: " .. tostring(value))
        return false
    end
    
    local results = gg.getResults(${maxResults})
    if #results == 0 then
        gg.alert("⚠️ No results found for value: " .. tostring(value))
        return false
    end
    
    gg.alert("✅ Found " .. #results .. " results for value: " .. tostring(value))
    return true
end

function safeEdit(value, type, confirm)
    ${autoSave ? 'gg.saveList("CPMGARAGE_Backup_" .. os.time() .. ".txt", gg.getResults(999999))' : ''}
    
    ${confirmEdit ? `if confirm then
        local choice = gg.choice({
            "✅ Yes, edit values",
            "❌ Cancel"
        }, nil, "Confirm Edit to: " .. tostring(value))
        if choice == nil or choice == 2 then
            gg.alert("❌ Edit cancelled")
            return false
        end
    end` : ''}
    
    local editCount = gg.editAll(value, type)
    if editCount and editCount > 0 then
        gg.alert("✅ Successfully edited " .. editCount .. " values to: " .. tostring(value))
        ${freezeValues ? 'gg.addListItems(gg.getResults(999999))' : ''}
        return true
    else
        gg.alert("❌ Failed to edit values")
        return false
    end
end

`;

            // Generate individual functions with multiple search support
            functions.forEach((funcName, funcIndex) => {
                const editValue = document.getElementById(`editValue${funcIndex}`)?.value || '999999';
                const editType = document.getElementById(`editType${funcIndex}`)?.value || 'gg.TYPE_DWORD';
                const preEditToast = document.getElementById(`preEditToast${funcIndex}`)?.value;
                const preEditAlert = document.getElementById(`preEditAlert${funcIndex}`)?.value;
                const preEditSleep = document.getElementById(`preEditSleep${funcIndex}`)?.value;
                const postEditToast = document.getElementById(`postEditToast${funcIndex}`)?.value;
                const postEditAlert = document.getElementById(`postEditAlert${funcIndex}`)?.value;
                const postEditSleep = document.getElementById(`postEditSleep${funcIndex}`)?.value;

                script += `-- Function: ${funcName}
function func_${funcIndex + 1}()
`;

                const searchesForFunction = searchCount[funcIndex] || 1;
                for (let searchIndex = 0; searchIndex < searchesForFunction; searchIndex++) {
                    const searchValue = document.getElementById(`searchValue${funcIndex}_${searchIndex}`)?.value || '0';
                    const searchType = document.getElementById(`searchType${funcIndex}_${searchIndex}`)?.value || 'gg.TYPE_DWORD';
                    const range = document.getElementById(`range${funcIndex}_${searchIndex}`)?.value || 'gg.REGION_ANONYMOUS';
                    const preToast = document.getElementById(`preToast${funcIndex}_${searchIndex}`)?.value;
                    const preAlert = document.getElementById(`preAlert${funcIndex}_${searchIndex}`)?.value;
                    const preSleep = document.getElementById(`preSleep${funcIndex}_${searchIndex}`)?.value;
                    const postToast = document.getElementById(`postToast${funcIndex}_${searchIndex}`)?.value;
                    const postAlert = document.getElementById(`postAlert${funcIndex}_${searchIndex}`)?.value;
                    const postSleep = document.getElementById(`postSleep${funcIndex}_${searchIndex}`)?.value;

                    if (searchIndex === 0) {
                        script += `    -- Initial Search: ${searchValue}
`;
                    } else {
                        script += `    -- Refine Search ${searchIndex}: ${searchValue}
`;
                    }
                    
                    if (preToast) {
                        script += `    gg.toast("${preToast}")
`;
                    }
                    
                    if (preAlert) {
                        script += `    gg.alert("${preAlert}")
`;
                    }

                    if (preSleep) {
                        script += `    gg.sleep(${preSleep})
`;
                    }

                    if (searchIndex === 0) {
                        script += `    if not safeSearch("${searchValue}", ${searchType}, ${range}) then
        gg.alert("❌ ${funcName} failed at initial search\\nReturning to main menu...")
        return
    end
`;
                    } else {
                        script += `    if not safeRefine("${searchValue}", ${searchType}) then
        gg.alert("❌ ${funcName} failed at refine step ${searchIndex}\\nReturning to main menu...")
        return
    end
`;
                    }

                    if (postSleep) {
                        script += `    gg.sleep(${postSleep})
`;
                    }

                    if (postToast) {
                        script += `    gg.toast("${postToast}")
`;
                    }
                    
                    if (postAlert) {
                        script += `    gg.alert("${postAlert}")
`;
                    }

                    script += `
`;
                }

                script += `    -- All searches completed, now edit to final value: ${editValue}
`;

                if (preEditToast) {
                    script += `    gg.toast("${preEditToast}")
`;
                }
                
                if (preEditAlert) {
                    script += `    gg.alert("${preEditAlert}")
`;
                }

                if (preEditSleep) {
                    script += `    gg.sleep(${preEditSleep})
`;
                }

                script += `    if safeEdit("${editValue}", ${editType}, ${confirmEdit}) then
`;

                if (postEditSleep) {
                    script += `        gg.sleep(${postEditSleep})
`;
                }

                if (postEditToast) {
                    script += `        gg.toast("${postEditToast}")
`;
                }
                
                if (postEditAlert) {
                    script += `        gg.alert("${postEditAlert}")
`;
                }

                script += `    else
        gg.alert("❌ ${funcName} edit failed\\nReturning to main menu...")
    end
    gg.clearResults()
end

`;
            });

            // Continue with the rest of the original script structure
            script += `-- Main Menu Function
function mainMenu()
    local menu = gg.multiChoice({
${functions.map((f, i) => `        "${i + 1}. 🎮 ${f}"`).join(',\n')},
        "${functions.length + 1}. ℹ️ About CPMGARAGESTUDIOS",
        "${functions.length + 2}. ❌ Exit"
    }, nil, "🚀 CPMGARAGESTUDIOS Lua Generator Pro\\n🎮 Car Parking Multiplayer")
    
    if menu == nil then 
        return 
    end
    
${functions.map((f, i) => `    if menu[${i + 1}] then func_${i + 1}() end`).join('\n')}
    
    if menu[${functions.length + 1}] then aboutCPMGARAGE() end
    if menu[${functions.length + 2}] then 
        gg.alert("👋 Thanks for using CPMGARAGESTUDIOS!")
        os.exit() 
    end
end

-- About CPMGARAGESTUDIOS
function aboutCPMGARAGE()
    gg.alert([[
🚀 CPMGARAGESTUDIOS

🎮 Premium Car Parking Multiplayer Tools
🔧 Advanced Lua Script Generation
📱 Follow us for latest updates

📍 Website: https://cpmgarage.github.io/cpmgaragestudios
📱 Instagram: @_CPMGARAGE
📱 Telegram: @cpmgaragegg
📚 Values: GG Learning Studio

⚡ Version: 2.0 (Multi-Search)
📅 Generated: ]] .. os.date("%Y-%m-%d %H:%M:%S") .. [[

Thanks for choosing CPMGARAGESTUDIOS!
    ]], "About CPMGARAGESTUDIOS", "Close")
end

-- Main Script Loop
showBanner()

local scriptRunning = true
while scriptRunning do
    if gg.isVisible(true) then
        gg.setVisible(false)
        mainMenu()
    end
    gg.sleep(100)
end`;

            return script;
        }

        function downloadScript() {
            const script = editor.getValue();
            const blob = new Blob([script], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `CPMGARAGESTUDIOS_Script_${new Date().toISOString().slice(0,10)}.lua`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Show encryption option after download
            Swal.fire({
                title: '🔒 Script Encryption Option',
                html: `
                    <div style="text-align: left; color: #0ff;">
                        <h3 style="color: #0ff; text-shadow: 0 0 10px #0ff; margin-bottom: 15px;">🛡️ Protect Your Script</h3>
                        
                        <p style="margin-bottom: 10px;"><strong>Why encrypt your script?</strong></p>
                        <ul style="margin-bottom: 15px; padding-left: 20px;">
                            <li><strong>Protection:</strong> Prevents others from stealing your work</li>
                            <li><strong>Security:</strong> Hides your search values and techniques</li>
                            <li><strong>Professional:</strong> Makes your script look more polished</li>
                            <li><strong>Anti-Detection:</strong> Some games scan for common script patterns</li>
                        </ul>
                        
                        <p style="margin-bottom: 10px;"><strong>Encryption adds:</strong></p>
                        <ul style="margin-bottom: 15px; padding-left: 20px;">
                            <li>Code obfuscation and minification</li>
                            <li>Variable name randomization</li>
                            <li>String encoding and compression</li>
                            <li>Anti-reverse engineering measures</li>
                        </ul>
                        
                        <p style="color: #f0f; text-shadow: 0 0 5px #f0f;"><strong>🔐 Would you like to encrypt this script?</strong></p>
                    </div>
                `,
                icon: null,
                confirmButtonText: '🔒 Encrypt Script',
                showCancelButton: true,
                cancelButtonText: '📄 Keep Unencrypted',
                allowOutsideClick: false,
                customClass: {
                    popup: 'swal2-popup',
                    title: 'swal2-title',
                    content: 'swal2-content',
                    confirmButton: 'swal2-confirm',
                    cancelButton: 'swal2-cancel'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // Generate encrypted version
                    const encryptedScript = encryptLuaScript(script);
                    const encryptedBlob = new Blob([encryptedScript], { type: 'text/plain;charset=utf-8' });
                    const encryptedUrl = URL.createObjectURL(encryptedBlob);
                    const encryptedLink = document.createElement('a');
                    encryptedLink.href = encryptedUrl;
                    encryptedLink.download = `CPMGARAGESTUDIOS_Script_Encrypted_${new Date().toISOString().slice(0,10)}.lua`;
                    document.body.appendChild(encryptedLink);
                    encryptedLink.click();
                    document.body.removeChild(encryptedLink);
                    URL.revokeObjectURL(encryptedUrl);

                    Swal.fire({
                        icon: 'success',
                        title: '🔒 Encrypted Script Downloaded!',
                        text: 'Your protected script has been downloaded successfully!',
                        timer: 3000,
                        showConfirmButton: false
                    });
                } else {
                    Swal.fire({
                        icon: 'success',
                        title: '📥 Download Complete!',
                        text: 'Your CPMGARAGESTUDIOS Lua script has been downloaded!',
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
            });
        }

        // Simple script encryption function
        function encryptLuaScript(script) {
            const lines = script.split('\n');
            let encrypted = `-- CPMGARAGESTUDIOS Encrypted Script
-- Generated: ${new Date().toLocaleString()}
-- Protected by CPMGARAGESTUDIOS Encryption
-- Visit: https://cpmgarage.github.io/cpmgaragestudios

`;
            
            // Basic obfuscation - encode the script
            const encodedScript = btoa(unescape(encodeURIComponent(script)));
            const chunks = encodedScript.match(/.{1,80}/g) || [];
            
            encrypted += `local encoded = {\n`;
            chunks.forEach((chunk, i) => {
                encrypted += `    "${chunk}"${i < chunks.length - 1 ? ',' : ''}\n`;
            });
            encrypted += `}\n\n`;
            
            encrypted += `local function decode(t)
    local s = ""
    for i = 1, #t do
        s = s .. t[i]
    end
    return s
end

local function exec()
    local decoded = decode(encoded)
    local script = (function()
        local a, b = pcall(function()
            return load and load or loadstring
        end)
        return b and b() or function() end
    end)()(atob and atob(decoded) or (function(data)
        local b = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
        data = string.gsub(data, '[^'..b..'=]', '')
        return (data:gsub('.', function(x)
            if (x == '=') then return '' end
            local r,f='',(b:find(x)-1)
            for i=6,1,-1 do r=r..(f%2^i-f%2^(i-1)>0 and '1' or '0') end
            return r;
        end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
            if (#x ~= 8) then return '' end
            local c=0
            for i=1,8 do c=c+(x:sub(i,i)=='1' and 2^(8-i) or 0) end
            return string.char(c)
        end))
    end)(decoded))
    
    if script then
        script()
    else
        gg.alert("Script execution failed")
    end
end

exec()
`;
            
            return encrypted;
        }

        function copyToClipboard() {
            const script = editor.getValue();
            navigator.clipboard.writeText(script).then(() => {
                Swal.fire({
                    icon: 'success',
                    title: '📋 Copied!',
                    text: 'Script copied to clipboard successfully!',
                    timer: 2000,
                    showConfirmButton: false
                });
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = script;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                Swal.fire({
                    icon: 'success',
                    title: '📋 Copied!',
                    text: 'Script copied to clipboard!'
                });
            });
        }

        function clearAll() {
            Swal.fire({
                title: '🗑️ Clear Everything?',
                text: 'This will remove all functions and reset the generator.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, clear all!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('functionsInput').value = '';
                    document.getElementById('functionsContainer').innerHTML = '';
                    functionCount = 0;
                    searchCount = {};
                    
                    document.getElementById('downloadBtn').disabled = true;
                    document.getElementById('copyBtn').disabled = true;
                    document.getElementById('generateBtn').disabled = true;
                    
                    editor.setValue('-- Your generated Lua script will appear here\\n-- CPMGARAGESTUDIOS Lua Generator Pro\\n-- Advanced Car Parking Multiplayer Script Generator\\n-- Visit: https://cpmgaragestudios.com', -1);
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Cleared!',
                        text: 'Everything has been reset.',
                        timer: 1500,
                        showConfirmButton: false
                    });
                }
            });
        }

        // Initialize the app
        updateGenerateButton();
    </script>
</body>
</html>